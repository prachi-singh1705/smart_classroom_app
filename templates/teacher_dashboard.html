{% extends "base.html" %}
{% block content %}
<div class="hero d-flex justify-content-between align-items-center">
  <div>
    <h2 style="margin:0; font-weight:800; color:#1f2340;">Teacher Control Center</h2>
    <p style="margin:4px 0 0;color: #60677f;">Create classrooms, start sessions, manage assignments & timetables — all from here.</p>
  </div>

  <div class="d-flex gap-2">
    <a class="btn btn-outline-primary" href="/teacher/classes">Your Classes</a>
    <a class="btn btn-main" href="/teacher/classes">Manage Classes</a>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="action-tile p-3" id="createClassTile" onclick="openCreateModal()">
      <div class="accent"></div>
      <div class="d-flex align-items-center">
        <div style="width:60px;height:60px;border-radius:12px;background:linear-gradient(135deg,#7b5cff,#4a5cf8);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:22px;margin-right:14px;">C</div>
        <div>
          <div class="tile-title">Create Your Classroom</div>
          <div class="tile-sub">Quickly create a classroom & generate a join code for students.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="action-tile p-3" onclick="location.href='/teacher/classes'">
      <div class="accent"></div>
      <div class="d-flex align-items-center">
        <div style="width:60px;height:60px;border-radius:12px;background:linear-gradient(135deg,#ff7a7a,#ffb86b);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:22px;margin-right:14px;">L</div>
        <div>
          <div class="tile-title">Your Classrooms</div>
          <div class="tile-sub">View classes you’ve created, students, sessions & attendance reports.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="action-tile p-3" onclick="location.href='/teacher/classes'">
      <div class="accent"></div>
      <div class="d-flex align-items-center">
        <div style="width:60px;height:60px;border-radius:12px;background:linear-gradient(135deg,#42e695,#3bb2b8);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:22px;margin-right:14px;">S</div>
        <div>
          <div class="tile-title">Start Teaching</div>
          <div class="tile-sub">Generate a live session link for students to join and mark attendance automatically.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Stats -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="class-card p-3">
      <div class="d-flex align-items-center">
        <div style="font-size:28px;font-weight:700; color: #4a5cf8;">0</div>
        <div style="margin-left:12px;">
          <div class="small text-muted">Total Classes</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="class-card p-3">
      <div class="d-flex align-items-center">
        <div style="font-size:28px;font-weight:700; color:#ff7a7a;">0</div>
        <div style="margin-left:12px;">
          <div class="small text-muted">Active Sessions</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="class-card p-3">
      <div class="d-flex align-items-center">
        <div style="font-size:28px;font-weight:700; color:#3bb2b8;">0</div>
        <div style="margin-left:12px;">
          <div class="small text-muted">Total Students</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="class-card p-3">
      <div class="d-flex align-items-center">
        <div class="loader" style="margin-right:12px;"></div>
        <div>
          <div class="small text-muted">Analytics</div>
          <div class="small text-muted">Live metrics coming soon</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create classroom modal -->
<div class="modal fade" id="createClassModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content modal-fade p-3">
      <h5>Create Classroom</h5>
      <div class="mb-2">
        <label class="form-label">Class Name</label>
        <input id="className" class="form-control" placeholder="Enter class name">
      </div>
      <div class="mb-2">
        <label class="form-label">Subject Name</label>
        <input id="subjectName" class="form-control" placeholder="Enter subject (e.g. Physics)">
      </div>
      <div class="d-flex justify-content-end gap-2 mt-2">
        <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-main" id="generateClassBtn">Generate Classroom Code</button>
      </div>
      <div id="createResult" class="mt-3"></div>
    </div>
  </div>
</div>

<script>
function openCreateModal(){
  var myModal = new bootstrap.Modal(document.getElementById('createClassModal'));
  document.getElementById('createResult').innerHTML = '';
  document.getElementById('className').value = '';
  document.getElementById('subjectName').value = '';
  myModal.show();
}

document.getElementById('generateClassBtn').addEventListener('click', async function(){
  const name = document.getElementById('className').value.trim();
  const subject = document.getElementById('subjectName').value.trim();
  if(!name){ alert('Enter class name'); return; }
  this.disabled = true;
  this.innerHTML = 'Generating...';
  try{
    const res = await fetch('/api/classes/create', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({class_name: name, subject: subject})
    });
    const j = await res.json();
    if(res.ok){
      document.getElementById('createResult').innerHTML = `<div class="alert alert-success">Class created. Code: <strong>${j.classroom_code}</strong></div>`;
      setTimeout(()=>{ location.href = '/teacher/classes'; }, 900);
    } else {
      document.getElementById('createResult').innerHTML = `<div class="alert alert-danger">${j.error||'Error'}</div>`;
    }
  }catch(e){
    document.getElementById('createResult').innerHTML = `<div class="alert alert-danger">Network error</div>`;
  } finally {
    this.disabled = false; this.innerHTML = 'Generate Classroom Code';
  }
});
</script>

{% endblock %}
